<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{{PAGE_TITLE}}</title>
  <meta name="description" content="{{PAGE_DESCRIPTION}}" />
  <link rel="canonical" href="{{PAGE_CANONICAL}}">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="{{SITE_TITLE}}">
  <meta property="og:title" content="{{PAGE_TITLE}}">
  <meta property="og:description" content="{{PAGE_DESCRIPTION}}">
  <meta property="og:url" content="{{PAGE_CANONICAL}}">
  <meta property="og:image" content="https://local.starflow.uk/static/og.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{PAGE_TITLE}}">
  <meta name="twitter:description" content="{{PAGE_DESCRIPTION}}">
  <meta name="twitter:image" content="https://local.starflow.uk/static/og.jpg">

  <link rel="stylesheet" href="/static/styles.css" />
  {{HEAD_EXTRAS}}

  <!-- Google tag (gtag.js) — ONE instance only -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DT54KZVJK2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    /* Consent Mode v2 — default deny until accepted */
    gtag('consent', 'default', {
      analytics_storage: 'denied',
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });

    gtag('js', new Date());
    gtag('config', 'G-DT54KZVJK2', { anonymize_ip: true, send_page_view: true });
  </script>
</head>

<body>
  <!-- Minimal GDPR banner -->
  <div id="cookie-banner" style="background:#111;color:#fff;padding:10px;text-align:center">
    We use cookies for analytics (optional).
    <button onclick="acceptAnalytics()" style="margin-left:8px">Accept</button>
    <button onclick="declineAnalytics()" style="margin-left:6px">Decline</button>
  </div>
  <script>
    function acceptAnalytics(){
      gtag('consent', 'update', {
        analytics_storage: 'granted',
        ad_storage: 'granted',
        ad_user_data: 'granted',
        ad_personalization: 'granted'
      });
      var b = document.getElementById('cookie-banner'); if (b) b.style.display = 'none';
    }
    function declineAnalytics(){
      gtag('consent', 'update', {
        analytics_storage: 'denied',
        ad_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied'
      });
      var b = document.getElementById('cookie-banner'); if (b) b.style.display = 'none';
    }
    // outbound link tracking
    document.addEventListener('click', e => {
      const a = e.target.closest('a'); if(!a) return;
      const url = a.href;
      const isExternal = a.host && a.host !== location.host;
      if(isExternal) gtag('event','outbound_click',{link_url:url,link_text:a.textContent.trim()});
      if(a.closest('nav') || a.href.includes('/uk/')) gtag('event','select_town',{link_text:a.textContent.trim(),link_url:url});
    });
  </script>

  <header>
    <div class="container">
      <nav><a href="/">Home</a> · <a href="/uk/">UK Index</a></nav>
      <h1>{{SITE_TITLE}}</h1>
      <p class="muted">{{SITE_TAGLINE}}</p>
    </div>
  </header>

  <main class="container">
    {{CONTENT}}
  </main>

  <footer>
    <div class="container">
      <p>© {{YEAR}} {{SITE_TITLE}}. Info from public sources; check links for latest.
        <a href="/about/">About</a> · <a href="/contact/">Contact</a> ·
        <a href="/updates/">Submit an update</a>
      </p>
    </div>
  </footer>
</body>
</html>
